<p>ActiveRecord fournit plusieurs façons différentes pour effectuer des manipulations sur les modèles. Pour démontrer ça, nous allons utiliser un modèle <code>Task</code> qui a un champ de type entier appelé <code>priority</code> et regarder quelques une de ses méthodes via <code>script/console</code>. Pour chaque méthode, le SQL généré par Rails est montré à la suite.</p>
<p>On peut trouver la priorité de la première tâche comme ceci :</p>
<code class="terminal">
&gt;&gt; Task.first.priority
=&gt; 3
</code>
<code class="sql"> SELECT * FROM "tasks" LIMIT 1</code>

<p>Comment faire si nous voulons la somme des priorités de toutes les tâches ?</p>
<code class="terminal">
&gt;&gt; Task.sum(:priority)
=&gt; 12
</code>
<code class="sql">SELECT sum("tasks".priority) AS sum_priority FROM "tasks"</code>

<p>Nous pouvons même passer des conditions :</p>
<code class="terminal">
&gt;&gt; Task.sum(:priority, :conditions =&gt; {:completed =&gt; false })
=&gt; 2
</code>
<code class="sql">SELECT sum("tasks".priority) AS sum_priority FROM "tasks" WHERE (completed="f")</code>

<p>Aussi bien que <code>sum</code> il existe d'autres méthodes, comme <code>minimum</code>, <code>maximum</code> et <code>average</code>:</p>
<code class="terminal">
&gt;&gt; Task.minimum(:priority)
=&gt; 2
</code>
<code class="sql">SELECT min("tasks".priority) AS min_priority FROM "tasks"</code>

<code class="terminal">
&gt;&gt; Task.maximum(:priority)
=&gt; 5
</code>
<code class="sql">SELECT max("tasks".priority) AS max_priority FROM "tasks"</code>

<code class="terminal">
&gt;&gt; Task.average(:priority).to_f
=&gt; 3.0
</code>
<code class="sql">SELECT avg("tasks".priority) AS avg_priority FROM "tasks"</code>

<p>Le SQL généré par Rails quand ces méthodes sont utilisées les rends plus efficaces que de calculer ces valeurs en utilisant Ruby pour retourner toutes les <code>Tasks</code> et calculer les valeurs.</p>

<h3>Utiliser les méthodes avec des associations.</h3>
<p>Ces méthodes sont des méthodes de classe donc elles peuvent être utiliser via des associations. Si nous avons un modèle <code>Project</code>, lequel a beaucoup de tâches (<code>has_many :tasks</code>), nous pouvons accéder à ces méthodes pour les tâches d'un projet spécifique. Noter que, comme avant, nous pouvons passer des conditions à la méthode <code>find</code>.</p>
<code class="terminal">
  &gt;&gt; project = Project.first
  =&gt; #&lt;Project id: 1, title: "A Project"&gt;
  &gt;&gt; project.tasks.sum(:priority, :conditions =&gt; {:completed =&gt; true})
  =&gt; 10
</code>

<p>Ceci exécute le SQL suivant :</p>
<code class="sql">SELECT sum("tasks".priority) AS sum_priority FROM "tasks" WHERE ("tasks"."completed" = 't') AND ("tasks".project_id = 1)</code>