<p>이번 에피소드는 <code>with_scope</code>에 관한 내용입니다. 밑의 <code>Task</code> 모델은 완료되지 않은 태스크를 값을 돌려주는 클래스 함수를 가지고 있습니다.</p>
<pre class="ruby">
class Task &lt; ActiveRecord::Base
  belongs_to :project

  def self.find_incomplete
    find_all_by_complete(false, :order =&gt; 'created_at DESC')
  end
end
</pre>
<p>이 함수는 <code>TasksController</code>에서 사용할 수 있습니다.</p>
<pre class="ruby">
class TasksController &lt; ApplicationController
  def index
    @tasks = Task.find_incomplete
  end
</pre>
<p>하지만, 다른 조건을 추가해서(예를 들면 첫 20개만 가져온다던가) <code>find</code> 함수를 사용할 수 없다는 점에서 이 함수는 약간 재한적이라고 할 수 있습니다. 구채적으로 적어보면 다음과 같습니다.</p>
<pre class="ruby">@tasks = Task.find_incomplete :limit =&gt; 20</pre>
<p>이것을 하는 방법은 여러가지가 있지만 <code>find_incomplete</code> 함수에 해쉬로 인자를 붙여서 해결할 수도 있습니다. 하지만, <code>find_scope</code>를 사용하면 좀더 우아하게 <code>find</code> 조건을 넘겨줄수 있습니다.</p>
<pre class="ruby">
class Task &lt; ActiveRecord::Base
  belongs_to :project

  def self.find_incomplete(options = {})
    with_scope :find =&gt; options do
      find_all_by_complete(false, :order =&gt; 'created_at DESC')
    end
  end
end
</pre>
<p><code>with_scope</code> 블록 안쪽에서 실행되는 어떤 <code>find</code> 도 자동으로 특정옵션을 상속 받게 됩니다. 이제 <code>find_incomplete</code> 는 어떤 조건도 전달 받을 수 있게 되었습니다. 이 함수는 다른 스코프가 없을때에도 문제없이 동작합니다. 이 함수는 <code>ProjectsController</code>에서 부를 수 있고, 리미트 조건도 걸 수 있습니다. 이 <code>find</code> 는 2가지 스코프를 거쳐서 동작합니다: 완료안된 테스크는 1.특정 프로젝트 범위내에서, 2.상위의 20개만 가져옵니다.</p>
<pre class="ruby">
@tasks = @project.tasks.find_incomplete :limit =&gt; 20
</pre>
