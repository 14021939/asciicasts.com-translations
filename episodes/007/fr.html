<p>Cet épisode est entièrement consacré aux layouts. Les layouts sont des fichiers de vue qui définissent le code qui englobe un gabarit (template). Ils peuvent être partagé dans beaucoup d'actions et de contrôleurs.</p>
<h3>Les layouts applicatif</h3>
<p>Le gabarit ci-dessous liste tout les projets.</p>
<pre class="ruby">
&lt;h2&gt;Projects&lt;/h2&gt;
&lt;ul&gt;
&lt;% for project in @projects %&gt;
    &lt;li&gt;&lt;%= project.name %&gt;&lt;/li&gt;
&lt;% end %&gt;
&lt;/ul&gt;
</pre>
<p>Il génère une page web assez basique :</p>
<img src="/system/photos/3/original/E007I01.png" title="Basic page without layout" alt="Basic page without layout" width="800" height="400" />
<p>Si nous voulons ajouter, disons, une entête, un logo et un menu de navigation à ce site et les avoir sur chaque page alors nous devrions utiliser un layout. Les layouts sont stockés dans le répertoire <code>/app/view/layouts</code> de l'application Rails. Pour en créer un, créez un nouveau fichier nommé <code>application.rhtml</code><a href="#fn1"><sup>[1]</sup></a> dans le dossier des layouts. Ceci créera un layout global qui sera utilisé par tous les contrôleurs et toutes les actions. Le layout de notre application ressemble à ça :</p>
<pre class="ruby">
&lt;h1&gt;Application Layout!&lt;/h1&gt;
&lt;%= yield %&gt;
</pre>
<p>La ligne importante dans le code ci-dessus est la seconde. Le mot clé <code>yield</code> dit au layout où placer le contenu pour les templates qui utilisent le layout. Maintenant, si nous regardons à nouveau la page d'avant, nous pouvons voir que le layout a été ajouté.</p>
<img src="/system/photos/4/original/E007I02.png" title="Basic page with layout" alt="Basic page with layout" width="800" height="400" />
<p>Le layout est global, donc il sera ajouté à n'importe quelle action de n'importe quel contrôleur de l'application. La plupart du temps ceci suffira mais que faire si nous avons besoin de layouts différents pour différentes parties de notre application ?</p>

<h3>Les layouts spécifiques à un contrôleur</h3>
<p>Un layout peut être rendu spécifique à un contrôleur en donnant au layout le nom du contrôleur. Ainsi pour faire qu'un layout qui sera utilisé par toutes les actions dans le contrôleur <code>Projects</code>, créez un fichier dans le répertoire <code>layouts</code> que vous nommerez <code>projects.rhtml</code><a href="#fn2"><sup>[2]</sup></a>. Ça signifie que le layout sera utilisé uniquement par le contrôleur <code>Projects</code>.</p>
<pre class="ruby">
&lt;h1&gt;Project Layout!&lt;/h1&gt;
&lt;%= yield %&gt;
</pre>
<img src="/system/photos/5/original/E007I03.png" title="Basic page with controller-specific layout" alt="Basic page with controller-specific layout" width="800" height="400" />
<p>Comment faire pour partager un layout avec plusieurs contrôleur, pas uniquement pour un seul, e.g. un layout pour l'administration ? Rails vous permet d'utiliser la commande <code>layout</code> pour spécifier le nom du layout qui devrait être utilisé au sein d'un contrôleur..</p>
<pre class="ruby">
class ProjectsController &lt; ApplicationController
  layout "admin" 

  def index
    @projects = Project.find(:all)
  end
end
</pre>
<p class="title">Un layout spécifié avec la commande <code>layout</code> surchargera n'importe quels layouts spécifiques à un contrôleur ou à une application.</p>

<h3>Les layouts dynamiques</h3>
<p>Les layouts peuvent aussi être utilisés dynamiquement. Nous pourrions seulement vouloir que le layout <code>admin</code> soit utiliser quand un utilisateur est connecté. Ça peut être fait en transmettant un symbole comme argument à la commande <code>layout</code> et en créant une méthode avec le même nom que le symbole qui détermine quel layout devrait être utilisé.</p>
<pre class="ruby">
class ProjectsController &lt; ApplicationController
  layout :user_layout

  def index
    @projects = Project.find(:all)
  end

  protected
  def user_layout
    if current_user.admin?
      "admin" 
    else
      "application" 
    end
  end
end    
</pre>
<p>Nous pouvons restreindre un layout à une seule action dans un contrôleur avec la commande <code>render</code>.</p>
<pre class="ruby">
def index
  @projects = Project.find(:all)
  render :layout =&gt; 'projects'
end
</pre>
<p>Le layout spécifié avec la commande <code>render</code> surchargera n'importe quel layout spécifique à un contrôleur. Pour rendre une action sans aucun layout, on peut utiliser :</p>
<pre class="ruby">render :layout =&gt; false</pre>

<h3>Notes</h3>
<ol class="footnotes">
  <li id="fn1">Dans Rails 2 et supérieur, le fichier devrait être appelé <code>application.html.erb</code></li>
  <li id="fn2">À nouveau, pour Rails 2 et supérieur, l'extension devrait être <code>.html.erb</code> plutôt que <code>.rhtml</code>.</li>
</ol>