<p>&#x591A;&#x6001;&#x5173;&#x8054;&#x65E9;&#x5DF2;&#x7ECF;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;Rails&#x7684;&#x65B0;&#x7279;&#x6027;&#x4E86;&#xFF0C;&#x65E9;&#x5728;Rails 1.1&#x7684;&#x5C31;&#x88AB;&#x5F15;&#x5165;&#x8FDB;&#x6765;&#x3002;&#x4E0D;&#x8FC7;&#x5B83;&#x53EF;&#x80FD;&#x4F1A;&#x8BA9;&#x4E00;&#x4E9B;&#x6CA1;&#x6709;&#x7ECF;&#x9A8C;&#x7684;Rails&#x5F00;&#x53D1;&#x8005;&#x611F;&#x5230;&#x56F0;&#x60D1;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x8FD9;&#x4E00;&#x6B21;&#x6211;&#x4EEC;&#x5C06;&#x7528;&#x591A;&#x6001;&#x5173;&#x8054;&#x4F5C;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x793A;&#x8303;&#x6765;&#x8BF4;&#x660E;&#x5B83;&#x5230;&#x5E95;&#x8BE5;&#x600E;&#x4E48;&#x7528;&#x3002;</p>

<div class="imageWrapper">
  <img src="/system/photos/71/original/E154I01.png" width="826" height="508" alt="The site we want to add comments to."/>
</div>

<p>&#x4EE5;&#x4E0A;&#x7684;&#x9875;&#x9762;&#x6765;&#x81EA;&#x4E00;&#x4E2A;&#x62E5;&#x6709;&#x4E09;&#x4E2A;model&#xFF08;articles, photos &#x548C;events&#xFF09;&#x7684;&#x7AD9;&#x70B9;&#x3002;&#x73B0;&#x5728;&#xFF0C;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x8BA9;&#x7528;&#x6237;&#x80FD;&#x591F;&#x4E3A;articles&#x3001;photos&#x6216;&#x8005;events&#x6DFB;&#x52A0;&#x8BC4;&#x8BBA;&#xFF08;comment&#xFF09;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x53EA;&#x8981;&#x7B80;&#x5355;&#x7684;&#x4E3A;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x6DFB;&#x52A0;&#x8BC4;&#x8BBA;&#x529F;&#x80FD;&#xFF0C;&#x5047;&#x8BBE;&#x662F;&#x6587;&#x7AE0;&#xFF08;article&#xFF09;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x53EB;<code>Comment</code>&#x7684;model&#xFF0C;&#x5E76;&#x5728;<code>Article</code>&#x548C;<code>Comment</code>&#x4E4B;&#x95F4;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;<code>has_many</code> / <code>belongs_to</code>&#x5173;&#x8054;&#x3002;&#x5728;&#x8FD9;&#x79CD;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x7684;&#x591A;&#x6001;&#x5173;&#x8054;&#xFF08;polymorphic associations&#xFF09;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5FC5;&#x987B;&#x4E3A;&#x5404;&#x4E2A;model&#x5EFA;&#x7ACB;3&#x4E2A;&#x4E0D;&#x540C;&#x7684;comment model,&#x7EE7;&#x800C;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7801;&#x4F1A;&#x6709;&#x5F88;&#x591A;&#x91CD;&#x590D;&#x7684;&#x90E8;&#x5206;&#x3002;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x6211;&#x4EEC;&#x5C31;&#x8BE5;&#x4F7F;&#x7528;&#x591A;&#x6001;&#x5173;&#x8054;&#xFF0C;&#x5B83;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x53EA;&#x8981;&#x5EFA;&#x4E00;&#x4E2A;Comment model&#xFF08;&#x6E05;&#x6D01;&#x4E86;&#x5F88;&#x591A;&#xFF0C;&#x4FDD;&#x8BC1;&#x4E86;Dry&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x8BA9;&#x6BCF;&#x4E00;&#x6761;comment&#x77E5;&#x9053;&#x81EA;&#x5DF1;&#x662F;&#x8DDF;&#x5177;&#x4F53;&#x7684;&#x54EA;&#x4E2A;model&#x5173;&#x8054;&#x7684;&#x5C31;&#x884C;&#x4E86;&#x3002;</p>

<h3>&#x521B;&#x5EFA;Comment Model</h3>
<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x8981;&#x505A;&#x7684;&#x7B2C;&#x4E00;&#x4EF6;&#x4E8B;&#x5C31;&#x662F;&#x521B;&#x5EFA;<code>Comment</code> model&#x3002;&#x5C31;&#x7528;&#x666E;&#x901A;&#x7684;&#x521B;&#x5EFA;model&#x7684;&#x65B9;&#x5F0F;&#x53BB;&#x521B;&#x5EFA;&#xFF0C;&#x4F46;&#x662F;&#x9700;&#x8981;&#x6709;&#x4E00;&#x70B9;&#x5C0F;&#x5C0F;&#x7684;&#x4E0D;&#x540C;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4EC5;&#x4EC5;&#x53EA;&#x4E3A;&#x6587;&#x7AE0;&#xFF08;<code>Article</code>&#xFF09;&#x521B;&#x5EFA;comment&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x53EB;&#x505A;<code>article_id</code>&#x7684;integer&#xFF08;&#x6574;&#x6570;&#x578B;&#xFF09;&#x5B57;&#x6BB5;&#x6765;&#x5B58;&#x50A8;&#x5916;&#x952E;&#xFF08;foreign key&#xFF09;&#xFF1B;&#x4F46;&#x662F;&#x73B0;&#x5728;&#x7684;&#x60C5;&#x51B5;&#x662F;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x66F4;&#x9AD8;&#x5C42;&#x7684;&#x62BD;&#x8C61;&#xFF0C;&#x6240;&#x6709;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6DFB;&#x52A0;model&#x7684;&#x5BF9;&#x8C61;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x5171;&#x540C;&#x70B9;&#xFF1A;&#x5141;&#x8BB8;&#x8BC4;&#x8BBA;&#xFF1B;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x5C06;&#x5916;&#x952E;&#x7684;&#x540D;&#x5B57;&#x5B9A;&#x4E3A;&#xFF1A;<code>commentable_id</code>&#x3002;&#x8FD8;&#x6709;&#xFF0C;&#x6BCF;&#x4E00;&#x6761;comment&#x9700;&#x8981;&#x77E5;&#x9053;&#x81EA;&#x5DF1;&#x5173;&#x8054;&#x7684;model&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5C31;&#x9700;&#x8981;&#x53E6;&#x4E00;&#x6761;&#x5B57;&#x6BB5;&#x53BB;&#x5B58;&#x50A8;&#x5B83;&#xFF0C;&#x547D;&#x540D;&#x4E3A;&#xFF1A;<code>commentable_type</code>&#xFF0C;&#x8FD9;&#x4E2A;&#x5B57;&#x6BB5;&#x5C06;&#x4FDD;&#x5B58;&#x5173;&#x8054;model&#x7684;&#x7C7B;&#x540D;&#x3002;</p>
<pre class="terminal">
script/generate model Comment content:text commentable_id:integer commentable_type:string
</pre>

<p>&#x4E00;&#x65E6;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x597D;&#x4E86;model&#x5E76;&#x4E14;&#x8FD0;&#x884C;&#x4E86;&#x76F8;&#x5E94;&#x7684;migration&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5F97;&#x4E3A;article, photo&#x548C;event&#x8FD9;&#x4E09;&#x4E2A;model&#x6DFB;&#x52A0;&#x5173;&#x8054;&#x5173;&#x7CFB;&#x4E86;&#x3002;</p>

<p class="codeFilePath">/app/models/comment.rb</p>
<pre class="ruby">
class Comment &lt; ActiveRecord::Base   
  belongs_to :commentable, :polymorphic =&gt; true  
end  
</pre>

<p>&#x6211;&#x4EEC;&#x4F7F;&#x7528;<code>belongs_to</code> <code>commentable</code>&#x4EE3;&#x66FF;&#x4E86;<code>belongs_to</code> &#x5176;&#x4ED6; model&#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x800C;&#x4E14;&#x58F0;&#x660E;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x591A;&#x6001;&#x5173;&#x8054;&#x5173;&#x7CFB;&#x3002;&#x73B0;&#x5728;&#xFF0C;&#x53EA;&#x8981;&#x662F;<code>has_many commentables</code>&#x7684;&#x5176;&#x4ED6;model&#x90FD;&#x53EF;&#x4EE5;&#x6709;&#x8BC4;&#x8BBA;&#x4E86;&#x3002;&#x5177;&#x4F53;&#x6765;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x5728;<code>Article</code>, <code>Photo</code>&#x548C;<code>Event</code>&#x7C7B;&#x4E2D;&#x6211;&#x4EEC;&#x8FD9;&#x6837;&#x5B9A;&#x4E49;&#x5173;&#x7CFB;&#xFF1A;</p>

<pre class="ruby">
has_many :comments, :as =&gt; :commentable
</pre>

<p>&#x8FD9;&#x5C06;&#x544A;&#x8BC9;&#x6240;&#x6709;&#x7684;&#x7C7B;&#xFF0C;&#x5B83;&#x4EEC;&#x901A;&#x8FC7;commentable&#x5173;&#x7CFB;&#x591A;&#x6001;&#x5173;&#x8054;&#x4E86;&#x5F88;&#x591A;&#x8BC4;&#x8BBA;&#x3002;</p>

<h3>&#x9009;&#x51FA;&#x8BC4;&#x8BBA;&#xFF08;&#x53CA;view&#xFF1F;&#xFF1F;&#x6CA1;&#x660E;&#x767D;&#x4E0D;&#x8FC7;&#x4E5F;&#x6CA1;&#x6709;&#x5F71;&#x54CD;&#x5566;&#xFF09;</h3>

<p>&#x73B0;&#x5728;&#x5173;&#x7CFB;&#x5DF2;&#x7ECF;&#x5728;&#x6211;&#x4EEC;&#x7684;model&#x4E4B;&#x95F4;&#x5EFA;&#x7ACB;&#x597D;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x5173;&#x6CE8;controller&#x548C;view&#x4E86;&#x3002;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E3A;<code>Comment</code> model&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;controller&#x3002;</p>

<pre class="terminal">
script/generate controller Comments
</pre>

<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x50CF;&#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x7684;&#x5173;&#x7CFB;&#x4E00;&#x6837;&#x7684;&#x5BF9;&#x5F85;comment model&#xFF0C;&#x4E3E;&#x4F8B;&#x6765;&#x8BF4;&#xFF0C;&#x8981;&#x53D6;&#x5F97;article&#x7684;&#x8BC4;&#x8BBA;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x7528;<code>article.comments</code>&#x6765;&#x83B7;&#x53D6;&#x3002;</p>

<h3>&#x83B7;&#x53D6;&#x6B63;&#x786E;&#x7684;&#x8BC4;&#x8BBA;</h3>

<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x5D4C;&#x5957;&#x8D44;&#x6E90;&#xFF08;nested resources&#xFF09;&#x7684;&#x8BDD;&#x5C31;&#x4F1A;&#x9047;&#x5230;&#x95EE;&#x9898;&#x4E86;&#x3002;&#x6BD4;&#x5982;&#x4F7F;&#x7528;<code>/articles/1/comments</code>&#x67E5;&#x770B;&#x67D0;&#x4E00;article&#x7684;&#x6240;&#x6709;comment&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8981;&#x60F3;&#x8BA9;&#x8FD9;&#x6837;&#x7684;&#x8BF7;&#x6C42;&#x6210;&#x529F;&#x6211;&#x4EEC;&#x5C31;&#x8981;&#x53BB;&#x4FEE;&#x6539;<code>routes.rb</code>&#x6587;&#x4EF6;&#x914D;&#x7F6E;&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x7684;comment&#x5C31;&#x4F1A;&#x88AB;&#x5F53;&#x6210;&#x76F8;&#x5E94;&#x7684;model&#x7684;&#x5D4C;&#x5957;&#x8D44;&#x6E90;&#xFF08;nested resources&#xFF09;&#x5BF9;&#x5F85;&#x4E86;&#x3002;&#xFF08;&#x8BD1;&#x6CE8;&#xFF1A;nested resources&#x7FFB;&#x8BD1;&#x6210;&ldquo;&#x5D4C;&#x5957;&#x8D44;&#x6E90;&rdquo;&#x4F3C;&#x4E4E;&#x6709;&#x70B9;&#x4E0D;&#x59A5;&#xFF0C;&#x5E94;&#x8BE5;&#x662F;&ldquo;&#x88AB;&#x5D4C;&#x5957;&#x7684;&#x8D44;&#x6E90;&rdquo;&#xFF0C;&#x4F46;&#x8FD9;&#x4E48;&#x7FFB;&#x8BD1;&#x7684;&#x6574;&#x53E5;&#x4F30;&#x8BA1;&#x66F4;&#x96BE;&#x7406;&#x89E3;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x4E0D;&#x80FD;&#x660E;&#x767D;&#x8FD9;&#x6BB5;&#x610F;&#x601D;&#xFF0C;&#x8FD8;&#x8BF7;&#x5BF9;&#x7167;&#x82F1;&#x6587;&#x7248;&#x5427;&#xFF09;</p>

<pre class="ruby">
map.resources :articles, :has_many =&gt; :comments  
map.resources :photos, :has_many =&gt; :comments  
map.resources :events, :has_many =&gt; :comments  
</pre>


<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;URL(<code>/articles/1/comments</code>)&#x8BBF;&#x95EE;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;article&#x7684;&#x6240;&#x6709;&#x8BC4;&#x8BBA;(comment), <code>CommentsController</code>&#x91CC;&#x7684;<code>index</code> action&#x5C06;&#x4F1A;&#x88AB;&#x6267;&#x884C;&#xFF0C;</p>
<pre class="ruby">
def index   
  @comments = Comment.all   
end  
</pre>

<p>&#x65E0;&#x8BBA;&#x6211;&#x4EEC;&#x4E3A;&#x4E00;&#x4E2A;<code>Article</code>,<code>Photo</code>&#x6216;&#x8005;<code>Event</code>&#x83B7;&#x53D6;&#x6240;&#x6709;&#x8BC4;&#x8BBA;&#x7684;&#x65F6;&#x5019;&#x8C03;&#x7528;&#x7684;&#x90FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;<code>index</code> action&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x505A;&#x70B9;&#x4EC0;&#x4E48;&#x8BA9;<code>index</code> action&#x77E5;&#x9053;&#x8FD4;&#x56DE;&#x54EA;&#x4E00;&#x4E9B;comments&#x3002;&#x5176;&#x4E2D;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#x662F;&#x8FED;&#x4EE3;&#x4F20;&#x5165;action&#x7684;&#x6240;&#x6709;&#x53C2;&#x6570;&#xFF08;parameter&#xFF09;&#xFF0C;&#x627E;&#x5230;&#x5176;&#x4E2D;&#x7C7B;&#x4F3C;<code>&lt;parent_resource&gt;_id</code>&#x5F62;&#x5F0F;&#x7684;&#x90A3;&#x4E2A;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x77E5;&#x9053;&#x4E86;&#x5230;&#x5E95;&#x662F;&#x54EA;&#x4E00;&#x4E2A;model&#x5728;&#x67E5;&#x8BE2;&#x8BC4;&#x8BBA;&#xFF08;comment&#xFF09;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x5199;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x52A0;&#x5728;<code>CommentsController</code>&#x4E2D;&#x3002;</p>

<pre class="ruby">
def find_commentable   
  params.each do |name, value|   
    if name =~ /(.+)_id$/   
      return $1.classify.constantize.find(value)   
    end  
  end  
  nil  
end
</pre>  

<p>&#x4EE5;&#x4E0A;&#x7684;&#x65B9;&#x6CD5;&#x8FED;&#x4EE3;&#x6240;&#x6709;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x5E76;&#x67E5;&#x627E;&#x5176;&#x4E2D;&#x4EE5;<code>_id</code>&#x7ED3;&#x5C3E;&#x7684;&#x90A3;&#x4E00;&#x4E2A;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x627E;&#x7684;&#x662F;&#x7B2C;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#xFF08;Article&#xFF09;&#x7684;&#x6240;&#x6709;&#x8BC4;&#x8BBA;&#xFF08;comment&#xFF09;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x5E94;&#x8BE5;&#x6709;&#x4E00;&#x4E2A;&#x53EB;<code>article_id</code>&#x7684;&#x53C2;&#x6570;&#x5E76;&#x4E14;&#x5B83;&#x7684;&#x503C;&#x4E3A;<code>1</code>&#xFF08;&#x8BD1;&#x6CE8;&#xFF1A;&#x7B2C;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x561B;&#x5F53;&#x7136;&#x662F;1&#xFF09;&#x3002;</p>

<p>&#x5982;&#x679C;&#x65B9;&#x6CD5;&#x53D1;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x5339;&#x914D;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x5B83;&#x5C06;&#x4F1A;&#x8C03;&#x7528;<a href="http://rails.rubyonrails.org/classes/Inflector.html#M001636"><code>classify</code></a>&#x65B9;&#x6CD5;&#x5C06;&#x5F97;&#x5230;&#x7684;<code>_id</code>&#x524D;&#x7684;&#x540D;&#x5B57;&#x4ECE;&#x8868;&#x660E;&#x8F6C;&#x53D8;&#x4E3A;model&#x540D;&#xFF08;&#x5373;<code>&ldquo;articles&rdquo;</code>&#x6216;<code>&ldquo;article&rdquo;</code>&#x5C06;&#x4F1A;&#x8F6C;&#x4E3A;&ldquo;Article&rdquo;&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x5BF9;classify&#x8FD4;&#x56DE;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x8C03;&#x7528;<a href="http://rails.rubyonrails.org/classes/Inflector.html#M001638"><code>contantize</code></a>&#x5C1D;&#x8BD5;&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x5E38;&#x91CF;&#xFF08;constant&#xFF09;&#x4E0E;&#x4E4B;&#x5339;&#x914D;&#xFF08;&#x8BD1;&#x6CE8;&#xFF1A;&#x5B57;&#x9762;&#x4E0A;&#x662F;&#x524D;&#x9762;&#x8FD9;&#x4E48;&#x7FFB;&#x8BD1;&#xFF0C;&#x5F88;&#x4E0D;&#x597D;&#x61C2;&#xFF0C;&#x672C;&#x8D28;&#x4E0A;&#x7684;&#x610F;&#x601D;&#x662F;&#x901A;&#x8FC7;&#x524D;&#x9762;&#x8F6C;&#x6362;&#x6765;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x627E;&#x5230;&#x76F8;&#x5E94;&#x7684;&#x7C7B;&#xFF08;Class&#xFF09;&#xFF0C;&#x8FD9;&#x6837;&#x540E;&#x9762;&#x624D;&#x597D;&#x8C03;&#x7528;find&#x65B9;&#x6CD5;&#xFF09;&#x3002;&#x6700;&#x540E;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x7C7B;&#x8C03;&#x7528;<code>find</code>&#x65B9;&#x6CD5;&#x67E5;&#x627E;value&#x503C;&#x5BF9;&#x5E94;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x8981;&#x5E2E;&#x5B83;&#x627E;&#x5230;&#x6240;&#x6709;&#x8BC4;&#x8BBA;&#x7684;&#x90A3;&#x4E2A;&ldquo;&#x88AB;&#x8BC4;&#x8BBA;&#x7684;&#x5BF9;&#x8C61;&rdquo;&#x3002;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x4F8B;&#x5B50;&#x91CC;&#xFF0C;&#x5C06;&#x8FD4;&#x56DE;&#x7B2C;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#xFF08;<code>Article</code>&#xFF09;&#x3002;</p>

<p>&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x7528;&#x4EE5;&#x4E0B;&#x8FD9;&#x4E2A;index action&#x65B9;&#x6CD5;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x6240;&#x6709;&#x8BC4;&#x8BBA;&#xFF08;comment&#xFF09;&#x4E86;&#x3002;</p>

<pre class="ruby">
def index   
  @commentable = find_commentable   
  @comments = @commentable.comments   
end  
</pre>

<h3>&#x6DFB;&#x52A0;&#x8BC4;&#x8BBA;</h3>
<p>&#x5728;index&#x9875;&#x9762;&#x5217;&#x51FA;&#x6240;&#x6709;&#x8BC4;&#x8BBA;&#x7684;&#x540C;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x5E0C;&#x671B;&#x7528;&#x6237;&#x80FD;&#x591F;&#x6DFB;&#x52A0;&#x8BC4;&#x8BBA;&#x3002;&#x800C;&#x6211;&#x4EEC;&#x7684;view&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x662F;&#x4EE5;&#x4E0B;&#x8FD9;&#x6837;&#x7684;&#x3002;</p>

<pre class="ruby">
&lt;h1&gt;Comments&lt;/h1&gt;   
	  
&lt;ul id=&quot;comments&quot;&gt;   
  &lt;% @comments.each do |comment| %&gt;   
    &lt;li&gt;&lt;%= comment.content %&gt;&lt;/li&gt;   
  	  &lt;% end %&gt;   
  	&lt;/ul&gt;   
	  
  	&lt;h2&gt;New Comment&lt;/h2&gt;   
   	&lt;% form_for [@commentable, Comment.new] do |form| %&gt;   
   	  &lt;ol class=&quot;formList&quot;&gt;   
   	    &lt;li&gt;   
   	      &lt;%= form.label :content %&gt;   
   	      &lt;%= form.text_area :content, :rows =&gt; 5 %&gt;   
   	    &lt;/li&gt;   
   	    &lt;li&gt;&lt;%= submit_tag &quot;Add comment&quot; %&gt;&lt;/li&gt;   
   	  &lt;/ol&gt;   
   	&lt;% end %&gt;  
</pre>

<p>&#x7B2C;&#x4E00;&#x90E8;&#x5206;&#x7684;view&#x4EE3;&#x7801;&#x6E32;&#x67D3;&#x51FA;&#x4E00;&#x4E2A;&#x65E0;&#x5E8F;&#x7684;&#x8BC4;&#x8BBA;&#x5217;&#x8868;&#x3002;&#x4E0B;&#x9762;&#x8DDF;&#x7740;&#x7684;&#x662F;&#x6DFB;&#x52A0;&#x8BC4;&#x8BBA;&#x7684;form&#x3002;&#x800C;&#x8FD9;&#x4E2A;form&#x7684;&#x63D0;&#x4EA4;&#x5BF9;&#x8C61;&#x662F;&#x4E00;&#x4E2A;&#x5D4C;&#x5957;&#x8D44;&#x6E90;&#xFF08;nested resource&#xFF09;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x8868;&#x793A;&#xFF0C;&#x6570;&#x7EC4;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x662F;&#x6211;&#x4EEC;&#x5C06;&#x4ECE;<code>find_commentable</code>&#x65B9;&#x6CD5;&#x5F97;&#x5230;&#x7684;<code>commentable</code>&#x5BF9;&#x8C61;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x5143;&#x7D20;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8BC4;&#x8BBA;&#x5BF9;&#x8C61;&#x3002;</p>

<p>&#x5F53;&#x8FD9;&#x4E2A;form&#x88AB;&#x63D0;&#x4EA4;&#x7684;&#x65F6;&#x5019;&#x5C06;&#x4F1A;&#x8C03;&#x7528;<code>CommentsController</code>&#x7684;<code>create</code> action&#x3002;</p>

<pre class="ruby">
def create   
  @commentable = find_commentable   
  @comment = @commentable.comments.build(params[:comment])   
  if @comment.save   
    flash[:notice] = &quot;Successfully saved comment.&quot;  
    redirect_to :id =&gt; nil  
  else  
    render :action =&gt; &#x27;new&#x27;  
  end  
end  
</pre>

<p>&#x8FD9;&#x91CC;&#x7B2C;&#x4E00;&#x4EF6;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x6211;&#x4EEC;&#x53C8;&#x8C03;&#x7528;&#x4E86;<code>find_commentable</code>&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x8BC4;&#x8BBA;&#x7684;&#x8BB0;&#x5F55;&#xFF1B;&#x5C06;&#x4F1A;&#x662F;&#x4E00;&#x7BC7;<code>Article</code>,&#x4E00;&#x5F20;<code>Photo</code>&#x6216;&#x8005;&#x4E00;&#x4E2A;<code>Event</code>&#xFF1B;&#x4E4B;&#x540E;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>build</code>&#x521B;&#x5EFA;&#x8BC4;&#x8BBA;&#x4E86;&#x3002;&#x5F53;&#x6211;&#x4EEC;&#x4FDD;&#x5B58;&#x4E86;&#x8FD9;&#x4E2A;model&#x540E;&#xFF0C;&#x8FD4;&#x56DE;<code>index</code>&#x9875;&#x9762;&#x4F1A;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x4E0D;&#x77E5;&#x9053;&#x6211;&#x4EEC;&#x8BC4;&#x8BBA;&#x662F;&#x5D4C;&#x5957;&#x5728;&#x54EA;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#x5185;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x6709;&#x5E2E;&#x52A9;&#x7684;hack&#x6280;&#x5DE7;&#x91CD;&#x5B9A;&#x5411;&#x7ED9;<code>id</code>&#x4E3A;<code>nil</code>&#x7684;&#x8BB0;&#x5F55;&#x3002;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x8FD4;&#x56DE;&#x5230;&#x5F53;&#x524D;&#xFF08;&#x5D4C;&#x5957;&#x8D44;&#x6E90;&#x5185;&#xFF09;&#x7684;index action&#x7136;&#x540E;&#x663E;&#x793A;&#x51FA;&#x6B63;&#x786E;&#x7684;&#x9875;&#x9762;&#x6765;&#x3002;</p>

<div class="imageWrapper">
  <img src="/system/photos/72/original/E154I02.png" width="808" height="396" alt="We can now add a comment to an article, a photo or an event."/>
  <p class="title">&#x6211;&#x4EEC;&#x8BC4;&#x8BBA;&#x5B8C;&#x540E;&#x6B63;&#x786E;&#x7684;&#x8FD4;&#x56DE;&#x4E86;index action&#x3002;</p>
</div>
 
<p>&#x6211;&#x4EEC;&#x7684;&#x8BC4;&#x8BBA;&#x73B0;&#x5728;&#x5F00;&#x59CB;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x4E86;&#x3002;&#x6211;&#x4EEC;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x6761;&#x8BC4;&#x8BBA;&#x5E76;&#x4E14;&#x8FD4;&#x56DE;&#x4E86;&#x6B63;&#x786E;&#x7684;&#x9875;&#x9762;&#x3002;&#x8FD9;&#x529F;&#x80FD;&#x5728;&#x5BF9;<code>Photo</code>&#x548C;<code>Event</code> model&#x4E5F;&#x540C;&#x6837;&#x80FD;&#x89C1;&#x6548;&#x3002;</p>

<h3>&#x7ED9;&#x8BFB;&#x8005;&#x7684;&#x7EC3;&#x4E60;</h3>

<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5C06;&#x8981;&#x505A;&#x7684;&#x662F;&#x628A;&#x521A;&#x521A;&#x5BF9;<code>index</code>&#x548C;<code>create</code> action&#x505A;&#x7684;&#x6539;&#x52A8;&#x5957;&#x7528;&#x5230;<code>CommentsController</code>&#x7684;&#x5176;&#x4ED6;&#x7684;action&#x4E0A;&#x53BB;&#xFF0C;&#x5C31;&#x7559;&#x7ED9;&#x8BFB;&#x8005;&#x4EEC;&#x81EA;&#x5DF1;&#x5B9E;&#x8DF5;&#x5427;&#x3002;</p>

<p>&#x7ED9;&#x82F1;&#x8BED;&#x56F0;&#x96BE;&#x7684;&#x540C;&#x5B66;&#x53C2;&#x8003;&#x7528;&#xFF0C;&#x82F1;&#x6587;&#x597D;&#x7684;&#x540C;&#x5B66;&#x8FD8;&#x662F;&#x5EFA;&#x8BAE;&#x770B;&#x539F;&#x7248;&#x6559;&#x7A0B;&#x3002;&#x5982;&#x6709;&#x9519;&#x8BEF;&#xFF0C;&#x6B22;&#x8FCE;&#x6307;&#x6B63;&#xFF0C;&#x53D1;&#x90AE;&#x4EF6;&#x5230;joey.d.darko@gmail.com</p>